
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>SQL Server Express nightmare - Felipe Lima</title>
	<meta name="author" content="Felipe Lima">

	
	<meta name="description" content="SQL Server Express Nightmare Whoever tried to use SQL Server Express for any medium sized project, has probably experienced some really painful &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Felipe Lima" type="application/atom+xml">
	
	<link rel="canonical" href="http://felipecsl.com/blog/2009/06/05/sql-server-express-nightmare/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-26310657-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<img src="http://www.gravatar.com/avatar/7fd4ba468da56bb5330a6352c1b54f52?s=160" alt="Profile Picture" style="width: 160px;" />
	
</div>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="http://about.me/felipecsl">About</a></li>
    <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
			<a class="google" href="https://plus.google.com/FelipeLimaf" rel="author" title="Google+">Google+</a>
		
		
			<a class="twitter" href="http://twitter.com/felipecsl" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/felipecsl" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/felipecsl">felipecsl</a> @ <a href="http://twitter.com">Twitter</a></small>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('felipecsl', 4, false);
	})(jQuery);
</script>


			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">SQL Server Express Nightmare</h1>
	<div class="entry-content" itemprop="articleBody"><p>Whoever tried to use SQL Server Express for any medium sized project, has probably experienced some really painful problems accessing the database file.</p>

<p>Express is a free version of this well known Microsoft database engine which is targeted for smaller business. It has some <a href="http://www.microsoft.com/sqlserver/2005/en/us/compare-features.aspx">limitations</a> when compared to the other enterprise-targeted versions.</p>

<p>One of its key differences is that, unlike the other versions, you don&rsquo;t need a database instance to start working. The only thing you need is an empty MDF file to start off. It can be created from Visual Studio (Add New Item > SQL Server Database) and you&rsquo;re ready to go. However, here is where the problems start&hellip;</p>

<p>The big issue is that the MDF is a regular windows file, like any other. This means that <strong>only one process is able to modify it at a time</strong>.</p>

<p>If you use Visual Studio and/or SQL Server Management Studio regularly, you have probably run into this error when working with SQL Server Express:</p>

<p><img src="/images/2009/6/image.axd.png" alt="" /></p>

<p>There are several reason reasons that could cause this. Here are two that I found most recurring:</p>

<p><strong>Cause 1.</strong> The NETWORK SERVICE user is not able to open the database file because it does not have rights to do so.</p>

<p><strong>Solution 1.</strong> Edit the file permissions and grant Read/Write rights to it: Right mouse click on file or containing folder > Security > Advanced > Edit</p>

<p>If the NETWORK SERVICE is already on the list, make sure it has read/write permission.</p>

<p>Else, click Add&hellip; and type NETWORK SERVICE in the edit field. Add the proper permissions and click Ok in all the open Windows. Reload the webpage.</p>

<p>In some machines, I&rsquo;ve seen the user IIS_IUSRS instead of NETWORK SERVICE, so you can try this one as well. (if it exists)</p>

<p><strong>Cause 2.</strong> Visual Studio is locking the database file. In some cases, when you edit the database inside VS using the Server Explorer window, the handle remais open even after you close the connection with the database.</p>

<p><strong>Solution 2.</strong> If your Visual Studio is open, go to the Server Explorer window and make sure the database connection closed.</p>

<p><img src="/images/2009/6/Sem+t%c3%adtulo.png" alt="" /></p>

<p>If you are using SQL Server Management Studio Express, you have to Detach the database (do not forget to check the checkbox &ldquo;Drop Connections&rdquo; in the subsequent screen):</p>

<p><img src="/images/2009/6/Sem+t%c3%adtulo2.png" alt="" /></p>

<p>Go to your webpage and try reloading it.  It should work now. In case it doesn&rsquo;t work, try closing your Solution inside VS or close the whole VS window. I&rsquo;ve seen cases where VS keeps the database locked even after you closed the connection in the Server Explorer. Unfortunately, the error above isn&rsquo;t related to an open connection and this is why it sometimes it gets really hard to diagnose the issue.</p>

<p>As I said before, only one connection may be open with the SQL Express database file at a time, so always make sure there is no other program with it open. This does not mean that it does not allow concurrent users using the database, but Visual Studio and Management Studio manage to open it in such a way that locks the file entirely. The reason is unknown to me.</p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2016

    Felipe Lima


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
	







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
