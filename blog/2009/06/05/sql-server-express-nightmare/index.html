
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>SQL Server Express nightmare - Felipe Lima</title>
  <meta name="author" content="Felipe Lima">

  
  <meta name="description" content="Whoever tried to use SQL Server Express for any medium sized project, has probably experienced some really painful problems accessing the database &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://felipecsl.com/blog/2009/06/05/sql-server-express-nightmare">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Felipe Lima" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href='http://fonts.googleapis.com/css?family=Quattrocento+Sans|Roboto:400,300' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26310657-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<body>
	<div class="container">
		<aside class="left">
			<div class="inner-left">
				<header>
					<img src="http://www.gravatar.com/avatar/7fd4ba468da56bb5330a6352c1b54f52?s=200" alt="Gravatar of Felipe Lima " title="Gravatar of Felipe Lima" class="profilepic" />
<hgroup>
  <h1><a href="/">Felipe Lima</a></h1>
  
    <h2 class="subtitle">@felipecsl</h2>
   
</hgroup>


				</header>
				<footer>
					<p>
	
		<a href="http://github.com/felipecsl" class="btn btn-dark">GitHub</a>
	
	
		<a href="http://twitter.com/felipecsl" class="btn btn-dark">Twitter</a>
	
</p>
				</footer>
			</div>
		</aside>
    	<section class="right">
    		<div class="inner-right">
    			<div id="posts">
    			  	<article class="post">
    
  <header>
    
      <h1 class="entry-title">SQL Server Express Nightmare</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-06-05T14:19:00-03:00" pubdate data-updated="true">Jun 5<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Whoever tried to use SQL Server Express for any medium sized project, has probably experienced some really painful problems accessing the database file.</p>

<p>Express is a free version of this well known Microsoft database engine which is targeted for smaller business. It has some <a href="http://www.microsoft.com/sqlserver/2005/en/us/compare-features.aspx">limitations</a> when compared to the other enterprise-targeted versions.</p>

<p>One of its key differences is that, unlike the other versions, you don&rsquo;t need a database instance to start working. The only thing you need is an empty MDF file to start off. It can be created from Visual Studio (Add New Item > SQL Server Database) and you&rsquo;re ready to go. However, here is where the problems start&hellip;</p>

<p>The big issue is that the MDF is a regular windows file, like any other. This means that <strong>only one process is able to modify it at a time</strong>.</p>

<p>If you use Visual Studio and/or SQL Server Management Studio regularly, you have probably run into this error when working with SQL Server Express:</p>

<p><img src="/images/2009/6/image.axd.png" alt="" /></p>

<p>There are several reason reasons that could cause this. Here are two that I found most recurring:</p>

<p><strong>Cause 1.</strong> The NETWORK SERVICE user is not able to open the database file because it does not have rights to do so.</p>

<p><strong>Solution 1.</strong> Edit the file permissions and grant Read/Write rights to it: Right mouse click on file or containing folder > Security > Advanced > Edit</p>

<p>If the NETWORK SERVICE is already on the list, make sure it has read/write permission.</p>

<p>Else, click Add&hellip; and type NETWORK SERVICE in the edit field. Add the proper permissions and click Ok in all the open Windows. Reload the webpage.</p>

<p>In some machines, I&rsquo;ve seen the user IIS_IUSRS instead of NETWORK SERVICE, so you can try this one as well. (if it exists)</p>

<p><strong>Cause 2.</strong> Visual Studio is locking the database file. In some cases, when you edit the database inside VS using the Server Explorer window, the handle remais open even after you close the connection with the database.</p>

<p><strong>Solution 2.</strong> If your Visual Studio is open, go to the Server Explorer window and make sure the database connection closed.</p>

<p><img src="/images/2009/6/Sem+t%c3%adtulo.png" alt="" /></p>

<p>If you are using SQL Server Management Studio Express, you have to Detach the database (do not forget to check the checkbox &ldquo;Drop Connections&rdquo; in the subsequent screen):</p>

<p><img src="/images/2009/6/Sem+t%c3%adtulo2.png" alt="" /></p>

<p>Go to your webpage and try reloading it.  It should work now. In case it doesn&rsquo;t work, try closing your Solution inside VS or close the whole VS window. I&rsquo;ve seen cases where VS keeps the database locked even after you closed the connection in the Server Explorer. Unfortunately, the error above isn&rsquo;t related to an open connection and this is why it sometimes it gets really hard to diagnose the issue.</p>

<p>As I said before, only one connection may be open with the SQL Express database file at a time, so always make sure there is no other program with it open. This does not mean that it does not allow concurrent users using the database, but Visual Studio and Management Studio manage to open it in such a way that locks the file entirely. The reason is unknown to me.</p>
</div>


</article>


        <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://felipecsl.com/blog/2009/06/05/sql-server-express-nightmare/" data-via="felipecsl" data-counturl="http://felipecsl.com/blog/2009/06/05/sql-server-express-nightmare/" >Tweet</a>
  
  
  
</div>





    			</div>
    			<footer id="footer">
    				<p class="credit">
  Copyright &copy; 2014 - Felipe Lima. Powered by <a href="http://octopress.org">Octopress</a>
</p>


    			</footer>
    			







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




<link href='http://fonts.googleapis.com/css?family=Quattrocento+Sans|Roboto:400,300' rel='stylesheet' type='text/css'>


  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26310657-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>




    		</div>
    	</section>
  	</div>
</body>
</html>
