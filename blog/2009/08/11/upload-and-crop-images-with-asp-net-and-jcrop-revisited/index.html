
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Upload and Crop Images with ASP.NET and jCrop - Revisited! - Felipe Lima</title>
  <meta name="author" content="Felipe Lima">

  
  <meta name="description" content="In the last days, while looking for a way to do image cropping in ASP.NET, I found out several high quality tools that do the job very well. The main &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://felipecsl.github.com/blog/2009/08/11/upload-and-crop-images-with-asp-net-and-jcrop-revisited/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Felipe Lima" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26310657-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Felipe Lima</a></h1>
  
    <h2>weblog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:felipecsl.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Upload and Crop Images With ASP.NET and jCrop - Revisited!</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-08-11T14:46:00-07:00" pubdate data-updated="true">Aug 11<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>In the last days, while looking for a way to do image cropping in ASP.NET, I found out several high quality tools that do the job very well. The main one is a great jQuery plugin called <a href="http://deepliquid.com/content/Jcrop.html">jCrop</a>. It has many useful features out of the box coupled with a well forged look and feel, which made me choose to use it with no doubt.</p>

<p>What I needed, exactly, was a way to enable users to upload pictures and crop them on the fly before storing them on the website database. I often use ASP.NET <a href="http://asp.net/dynamicdata">dynamic data</a> to build complete and fully functional data driven websites in minutes. ASP.NET Dynamic Data is based on page templates and field templates that are brought together in runtime using user controls, in order to generate custom forms for manipulating the database tables.</p>

<p>One of these field templates, is DbImage, which is available in the Dynamic Data <a href="http://aspnet.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=27026">preview 4 on Codeplex</a>. Basically, it maps a binary table column to a user control that consists of a FileUpload control, which you can use to upload the image. Then, the image bytes are stored in the database. It is obviously not the best way to store images on a database, but it is extremely convenient. In an ideal scenario, the table would only point to the actual path of the image on the disk.</p>

<p>So, my work was to couple together jCrop and ASP.NET Dynamic Data DbImage control, so that the user may choose to crop the image just before it is saved to the database.</p>

<p>I found a very complete and interesting post on this topic at <a href="http://www.mikesdotnetting.com/Article/95/Upload-and-Crop-Images-with-jQuery-JCrop-and-ASP.NET">mikesdotnetting.com</a>, which handles the actual image cropping part of the work with C#.</p>

<p>My work was then based on Mike&rsquo;s post and jCrop, putting it all together inside a DbImage to enable the whole workflow. The general flow is strongly based on Mike&rsquo;s code using panels and hidden fields to store the selected X, Y, Width and Height, but I moved to a more wizard-like flow, which should be more straightforward to the regular user.</p>

<p>I first added a &ldquo;Crop..&rdquo; button to the control that should launch jCrop with the selected image file.</p>

<p><img src="/images/2009/8/img1.jpg" alt="" /></p>

<p>Next step was to open a AJAX <a href="http://www.asp.net/AJAX/AjaxControlToolkit/Samples/ModalPopup/ModalPopup.aspx">ModalPopupExtender</a> and show the selected image ready to be cropped with jCrop:</p>

<p><img src="/images/2009/8/img2new2.jpg" alt="" /></p>

<p>Last step, check the cropped image and finish the Wizard:</p>

<p><img src="/images/2009/8/img3.jpg" alt="" /></p>

<p>The cropped image is then scaled down and added to the form:</p>

<p><img src="/images/2009/8/img4.jpg" alt="" /></p>

<p>In order to scale down the cropped image, I used a code from <a href="http://www.west-wind.com/Weblog/posts/283.aspx">Rick Strahl</a> and added to a page called GetThumb.aspx. This page receives the desired filename in the query string, fetches it from the crop temporary files directory and writes it to the response stream.</p>

<p>I am providing the whole set of files needed to accomplish this in a <a href="http://www.felipel.com/files/dbimage_crop.zip">zip file</a>. Follow these instructions for setup:</p>

<ol>
<li><p>Put the DbImage_Edit.ascx<em> files in the **<dynamic data website>\DynamicData\FieldTemplates*</em> folder;</p></li>
<li><p>Put the GetThumb.aspx* files in the website root (&ldquo;~&rdquo; folder);</p></li>
<li><p>Put the Limaf.Tools.Web.dll file in  <dynamic data website>\bin folder (the Crop and Thumb functions are there).</p></li>
<li><p>Create an &lsquo;images&rsquo; folder in your project root</p></li>
</ol>


<p>If you prefer, you can copy/paste get Mike&rsquo;s Crop and Rick&rsquo;s Thumbnails functions yourself and build them as part of the website. In this case, step 3 above is not needed.</p>

<p>I may have forgotten a file or a step or two, so please let me know if anything goes wrong.</p>

<p>Till next time!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Felipe Lima</span></span>

      








  


<time datetime="2009-08-11T14:46:00-07:00" pubdate data-updated="true">Aug 11<span>th</span>, 2009</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://felipecsl.github.com/blog/2009/08/11/upload-and-crop-images-with-asp-net-and-jcrop-revisited/" data-via="felipecsl" data-counturl="http://felipecsl.github.com/blog/2009/08/11/upload-and-crop-images-with-asp-net-and-jcrop-revisited/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2009/08/10/asp-net-70-562-certification-earned/" title="Previous Post: ASP.NET 70-562 Certification earned!">&laquo; ASP.NET 70-562 Certification earned!</a>
      
      
        <a class="basic-alignment right" href="/blog/2009/08/13/the-linq-expression-node-type-invoke-is-not-supported-in-linq-to-entities/" title="Next Post: The LINQ expression node type 'Invoke' is not supported in LINQ to Entities.">The LINQ expression node type 'Invoke' is not supported in LINQ to Entities. &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/12/06/publishing-an-android-library-to-maven-central/">Publishing an Android Library to Maven Central with Gradle</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/12/building-a-custom-view-with-android/">Building a Custom View with Android</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/20/animated-gifs-with-android/">Handling Animated GIFs with Android the right way</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/31/starting-with-android-managing-images/">Starting with Android - managing images</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/31/when-two-identical-strings-are-different/">When two identical strings are different?</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/felipecsl">@felipecsl</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'felipecsl',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<a href="mailto:felipe.lima@gmail.com" title="Pair program with me!">
  <img  src="http://pairprogramwith.me/badge.png"
        alt="Pair program with me!" style="width: 150px" />
</a>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Felipe Lima -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
