
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Hands on MongoDB with C# - Felipe Lima</title>
	<meta name="author" content="Felipe Lima">

	
	<meta name="description" content="Hands on MongoDB With C# During the last couple days I&rsquo;ve been experimenting with MongoDB and its C# driver, cleverly written by Sam Corder. I &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Felipe Lima" type="application/atom+xml">
	
	<link rel="canonical" href="http://felipecsl.com/blog/2010/03/01/hands-on-mongodb-with-c/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-26310657-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<img src="http://www.gravatar.com/avatar/7fd4ba468da56bb5330a6352c1b54f52?s=160" alt="Profile Picture" style="width: 160px;" />
	
</div>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="http://about.me/felipecsl">About</a></li>
    <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
			<a class="google" href="https://plus.google.com/FelipeLimaf" rel="author" title="Google+">Google+</a>
		
		
			<a class="twitter" href="http://twitter.com/felipecsl" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/felipecsl" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/felipecsl">felipecsl</a> @ <a href="http://twitter.com">Twitter</a></small>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('felipecsl', 4, false);
	})(jQuery);
</script>


			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Hands on MongoDB With C#</h1>
	<div class="entry-content" itemprop="articleBody"><p>During the last couple days I&rsquo;ve been experimenting with <a href="/admin/Pages/www.mongodb.com">MongoDB</a> and its <a href="http://github.com/samus/mongodb-csharp">C# driver</a>, cleverly written by Sam Corder. I&rsquo;m investigating it as a replacement for a SQL Server database I am using in a web application that is higly community driven. This specific characteristic is the one that makes the <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> movement rise atop regular RDBMS systems like SQL Server or MySQL, since it is hard to mantain relational integrity in these scenarios. Other key features of MongoDB are focus on performance and scalability.</p>

<p><a href="http://odetocode.com/Blogs/scott/archive/2009/10/13/experimenting-with-mongodb-from-c.aspx">K. Scott Allen</a> already wrote a quick intro on using the C# driver, so I used it as a tutorial for my first steps. Here are some thoughts I&rsquo;d like to share on this topic:</p>

<ul>
<li>I don&rsquo;t like being held by the verbosity of instantiating Document objects every time I want to manipulate the database, so I&rsquo;ve written method overloads for the main operations, like Insert, Update, Find and Delete that receive a plain object and only then convert them to Document. This allows us to leverage anonymous objects in C# and makes the code cleaner:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="n">Mongo</span> <span class="n">mongo</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mongo</span><span class="p">();</span>
</span><span class='line'><span class="n">mongo</span><span class="p">.</span><span class="n">Connect</span><span class="p">();</span>
</span><span class='line'><span class="n">Database</span> <span class="n">db</span> <span class="p">=</span> <span class="n">mongo</span><span class="p">[</span><span class="err">“</span><span class="n">testdb</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'><span class="kt">var</span> <span class="n">col</span> <span class="p">=</span> <span class="n">db</span><span class="p">[</span><span class="err">“</span><span class="n">users</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'><span class="k">foreach</span><span class="p">(</span><span class="n">Document</span> <span class="n">d</span> <span class="k">in</span> <span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">name</span> <span class="p">=</span> <span class="err">“</span><span class="n">John</span> <span class="n">Doe</span><span class="err">”</span><span class="p">}).</span><span class="n">Documents</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">johnId</span> <span class="p">=</span> <span class="n">d</span><span class="p">[</span><span class="err">”</span><span class="n">_id</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">johnName</span> <span class="p">=</span> <span class="n">d</span><span class="p">[</span><span class="err">“</span><span class="n">name</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code with this implementation is available on my fork of the driver at <a href="http://github.com/felipecsl/mongodb-csharp">github</a> an will hopefully be merged with the master soon.</p>

<p>MongoDB allows storage of files in the database, as well, through the <a href="http://www.mongodb.org/display/DOCS/GridFS">GridFS specification</a>. The C# api is already implemented and functional. Follow an example for writing a file to the database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">Mongo</span> <span class="n">mongo</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mongo</span><span class="p">();</span>
</span><span class='line'>    <span class="n">mongo</span><span class="p">.</span><span class="n">Connect</span><span class="p">();</span>
</span><span class='line'>    <span class="n">Database</span> <span class="n">db</span> <span class="p">=</span> <span class="n">mongo</span><span class="p">[</span><span class="err">“</span><span class="n">test</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">collection</span> <span class="p">=</span> <span class="n">db</span><span class="p">[</span><span class="err">“</span><span class="n">testcollection</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'>    <span class="n">GridFile</span> <span class="n">file</span> <span class="p">=</span> <span class="k">new</span> <span class="n">GridFile</span><span class="p">(</span><span class="n">db</span><span class="p">);</span>
</span><span class='line'>    <span class="n">using</span><span class="p">(</span><span class="n">GridFileStream</span> <span class="n">fs</span> <span class="p">=</span> <span class="n">file</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="err">“</span><span class="n">mycv</span><span class="err">”</span><span class="p">))</span> <span class="c1">// define the file name</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">ReadWriteStream</span><span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="n">OpenRead</span><span class="p">(</span><span class="err">@”</span><span class="n">C</span><span class="p">:</span><span class="err">\</span><span class="n">Data</span><span class="err">\</span><span class="n">felipelima_en</span><span class="p">.</span><span class="n">doc</span><span class="err">”</span><span class="p">),</span> <span class="n">fs</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">ReadWriteStream</span><span class="p">(</span>
</span><span class='line'>    <span class="n">Stream</span> <span class="n">readStream</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Stream</span> <span class="n">writeStream</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">Byte</span><span class="p">[]</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Byte</span><span class="p">[</span><span class="n">Int16</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">bytesRead</span> <span class="p">=</span> <span class="n">readStream</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">Int16</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">// write the required bytes</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="n">bytesRead</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">writeStream</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">bytesRead</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">bytesRead</span> <span class="p">=</span> <span class="n">readStream</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">Int16</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">readStream</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>
</span><span class='line'>    <span class="n">writeStream</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Database files work just like plain Documents and will be assigned an Id upon creation. Therefore, they can be later queried just like a regular document.</p>

<p>This was just a quick glance over MongoDB and C# integration. I&rsquo;m planning on using it on a large project and will post here my findings. More to come.</p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2015

    Felipe Lima


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
	







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
