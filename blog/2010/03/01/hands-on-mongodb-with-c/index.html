
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Hands on MongoDB with C# - Felipe Lima</title>
  <meta name="author" content="Felipe Lima">

  
  <meta name="description" content="During the last couple days I&#8217;ve been experimenting with MongoDB and its C# driver, cleverly written by Sam Corder. I&#8217;m investigating it &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://felipecsl.github.com/blog/2010/03/01/hands-on-mongodb-with-c/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Felipe Lima" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Felipe Lima</a></h1>
  
    <h2>weblog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:felipecsl.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Hands on MongoDB With C#</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-03-01T22:36:00-08:00" pubdate data-updated="true">Mar 1<span>st</span>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>During the last couple days I&#8217;ve been experimenting with <a href="/admin/Pages/www.mongodb.com">MongoDB</a> and its <a href="http://github.com/samus/mongodb-csharp">C# driver</a>, cleverly written by Sam Corder. I&#8217;m investigating it as a replacement for a SQL Server database I am using in a web application that is higly community driven. This specific characteristic is the one that makes the <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> movement rise atop regular RDBMS systems like SQL Server or MySQL, since it is hard to mantain relational integrity in these scenarios. Other key features of MongoDB are focus on performance and scalability.</p>

<p><a href="http://odetocode.com/Blogs/scott/archive/2009/10/13/experimenting-with-mongodb-from-c.aspx">K. Scott Allen</a> already wrote a quick intro on using the C# driver, so I used it as a tutorial for my first steps. Here are some thoughts I&#8217;d like to share on this topic:</p>

<ul>
<li>I don&#8217;t like being held by the verbosity of instantiating Document objects every time I want to manipulate the database, so I&#8217;ve written method overloads for the main operations, like Insert, Update, Find and Delete that receive a plain object and only then convert them to Document. This allows us to leverage anonymous objects in C# and makes the code cleaner:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="n">Mongo</span> <span class="n">mongo</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mongo</span><span class="p">();</span>
</span><span class='line'><span class="n">mongo</span><span class="p">.</span><span class="n">Connect</span><span class="p">();</span>
</span><span class='line'><span class="n">Database</span> <span class="n">db</span> <span class="p">=</span> <span class="n">mongo</span><span class="p">[</span><span class="err">“</span><span class="n">testdb</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'><span class="kt">var</span> <span class="n">col</span> <span class="p">=</span> <span class="n">db</span><span class="p">[</span><span class="err">“</span><span class="n">users</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'><span class="k">foreach</span><span class="p">(</span><span class="n">Document</span> <span class="n">d</span> <span class="k">in</span> <span class="n">col</span><span class="p">.</span><span class="n">Find</span><span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">name</span> <span class="p">=</span> <span class="err">“</span><span class="n">John</span> <span class="n">Doe</span><span class="err">”</span><span class="p">}).</span><span class="n">Documents</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">johnId</span> <span class="p">=</span> <span class="n">d</span><span class="p">[</span><span class="err">”</span><span class="n">_id</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">johnName</span> <span class="p">=</span> <span class="n">d</span><span class="p">[</span><span class="err">“</span><span class="n">name</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code with this implementation is available on my fork of the driver at <a href="http://github.com/felipecsl/mongodb-csharp">github</a> an will hopefully be merged with the master soon.</p>

<p>MongoDB allows storage of files in the database, as well, through the <a href="http://www.mongodb.org/display/DOCS/GridFS">GridFS specification</a>. The C# api is already implemented and functional. Follow an example for writing a file to the database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">Mongo</span> <span class="n">mongo</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mongo</span><span class="p">();</span>
</span><span class='line'>    <span class="n">mongo</span><span class="p">.</span><span class="n">Connect</span><span class="p">();</span>
</span><span class='line'>    <span class="n">Database</span> <span class="n">db</span> <span class="p">=</span> <span class="n">mongo</span><span class="p">[</span><span class="err">“</span><span class="n">test</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">collection</span> <span class="p">=</span> <span class="n">db</span><span class="p">[</span><span class="err">“</span><span class="n">testcollection</span><span class="err">”</span><span class="p">];</span>
</span><span class='line'>    <span class="n">GridFile</span> <span class="n">file</span> <span class="p">=</span> <span class="k">new</span> <span class="n">GridFile</span><span class="p">(</span><span class="n">db</span><span class="p">);</span>
</span><span class='line'>    <span class="n">using</span><span class="p">(</span><span class="n">GridFileStream</span> <span class="n">fs</span> <span class="p">=</span> <span class="n">file</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="err">“</span><span class="n">mycv</span><span class="err">”</span><span class="p">))</span> <span class="c1">// define the file name</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">ReadWriteStream</span><span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="n">OpenRead</span><span class="p">(</span><span class="err">@”</span><span class="n">C</span><span class="p">:</span><span class="err">\</span><span class="n">Data</span><span class="err">\</span><span class="n">felipelima_en</span><span class="p">.</span><span class="n">doc</span><span class="err">”</span><span class="p">),</span> <span class="n">fs</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">ReadWriteStream</span><span class="p">(</span>
</span><span class='line'>    <span class="n">Stream</span> <span class="n">readStream</span><span class="p">,</span>
</span><span class='line'>    <span class="n">Stream</span> <span class="n">writeStream</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">Byte</span><span class="p">[]</span> <span class="n">buffer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Byte</span><span class="p">[</span><span class="n">Int16</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">];</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">bytesRead</span> <span class="p">=</span> <span class="n">readStream</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">Int16</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">// write the required bytes</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="n">bytesRead</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">writeStream</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">bytesRead</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">bytesRead</span> <span class="p">=</span> <span class="n">readStream</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">Int16</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">readStream</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>
</span><span class='line'>    <span class="n">writeStream</span><span class="p">.</span><span class="n">Close</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Database files work just like plain Documents and will be assigned an Id upon creation. Therefore, they can be later queried just like a regular document.</p>

<p>This was just a quick glance over MongoDB and C# integration. I&#8217;m planning on using it on a large project and will post here my findings. More to come.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Felipe Lima</span></span>

      








  


<time datetime="2010-03-01T22:36:00-08:00" pubdate data-updated="true">Mar 1<span>st</span>, 2010</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://felipecsl.github.com/blog/2010/03/01/hands-on-mongodb-with-c/" data-via="felipecsl" data-counturl="http://felipecsl.github.com/blog/2010/03/01/hands-on-mongodb-with-c/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2010/02/21/the-magic-of-defaultmodelbinder/" title="Previous Post: The magic of DefaultModelBinder">&laquo; The magic of DefaultModelBinder</a>
      
      
        <a class="basic-alignment right" href="/blog/2010/03/19/how-to-disable-annoying-request-validation/" title="Next Post: How to disable annoying request validation">How to disable annoying request validation &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/03/31/starting-with-android-managing-images/">Starting with Android - managing images</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/31/when-two-identical-strings-are-different/">When two identical strings are different?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/14/getting-started-with-chef/">Getting started with Chef</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/05/protip-delete-words-on-iterm2-mac-osx/">Protip: Delete words on iTerm2 (Mac OSX)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/24/wombat-0-4-0-released/">Wombat 0.4.0 released!</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/felipecsl">@felipecsl</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'felipecsl',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Felipe Lima -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
